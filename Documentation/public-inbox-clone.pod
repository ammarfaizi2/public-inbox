=head1 NAME

public-inbox-clone - "git clone --mirror" wrapper

=head1 SYNOPSIS

public-inbox-clone INBOX_URL [INBOX_DIR]

public-inbox-clone ROOT_URL [DESTINATION]

=head1 DESCRIPTION

public-inbox-clone is a wrapper around C<git clone --mirror> for
making the initial clone of a remote HTTP(S) public-inbox.  It
allows cloning multi-epoch v2 inboxes with a single command and
zero configuration.

It does not run L<public-inbox-init(1)> nor
L<public-inbox-index(1)>.  Those commands must be run separately
if serving/searching the mirror is required.  As-is,
public-inbox-clone is suitable for creating a git-only backup.

public-inbox-clone creates a Makefile with handy targets to update the
inbox once indexed.  This Makefile may be edited by the user; it will
not be rewritten by L<public-inbox-fetch(1)> unless it is removed
completely.

public-inbox-clone does not use nor require any extra
configuration files (not even C<~/.public-inbox/config>).

L<public-inbox-fetch(1)> may be used to keep C<INBOX_DIR>
up-to-date.

For v2 inboxes, it will create a C<$INBOX_DIR/manifest.js.gz>
file to speed up subsequent L<public-inbox-fetch(1)>.

=head1 OPTIONS

=over

=item --epoch=RANGE

Restrict clones of L<public-inbox-v2-format(5)> inboxes to the
given range of epochs.  The range may be a single non-negative
integer or a (possibly open-ended) C<LOW..HIGH> range of
non-negative integers.  C<~> may be prefixed to either (or both)
integer values to represent the offset from the maximum possible
value.

For example, C<--epoch=~0> alone clones only the latest epoch,
C<--epoch=~2..> clones the three latest epochs.

Default: C<0..~0> or C<0..> or C<..~0>
(all epochs, all three examples are equivalent)

=item -I PATTERN

=item --include=PATTERN

When cloning a top-level with multiple inboxes, only clone inboxes and
repositories matching a given wildcard pattern (using C<*?> and C<[]> is
supported).

=item --exclude=PATTERN

When cloning a top-level with multiple inboxes, ignore inboxes and
repositories matching the given wildcard pattern.  Supports the same
wildcards as L</--include>

=item --inbox-config=always|v2|v1|never

Whether or not to retrieve the C<$INBOX/_/text/config/raw> HTTP(S)
endpoint when cloning.

Since we can't deduce v1 inboxes from code repositories, setting this
to C<v2> or C<never> can allow faster clones of code repositories if
no v1 inboxes are present.

Default: C<always>

=item --inbox-version=NUM

Force a remote public-inbox version (must be C<1> or C<2>).
This is auto-detected by default, and this option exists mainly
for testing.

=item --objstore=DIR

Enables space savings when the remote C<manifest.js.gz>
includes C<forkgroup> entries as generated by grokmirror 2.x.

If C<DIR> does not start with C</>, C<./>, or C<../>, it is treated
as relative to the C<DESTINATION> directory.  If only C<--objstore=>
is specified where C<DIR> is an empty string (C<"">), then C<objstore>
(C<$DESTINATION/objstore>) is the implied value of C<DIR>.

=item --manifest=FILE

When incrementally updating an existing mirror, load the given
manifest (typically C<manifest.js.gz>) to speed up updates.

By default, public-inbox writes the retrieved manifest to
C<$DESTINATION/manifest.js.gz>, this directive also
changes the destination to the specified C<FILE>

If C<FILE> does not start with C</>, C<./>, or C<../>, it is treated
as relative to the C<DESTINATION> directory.  If only C<--manifest=>
is specified where C<FILE> is an empty string (C<"">), then C<manifest.js.gz>
(C<$DESTINATION/manifest.js.gz>) is the implied value of C<FILE>.

=item --project-list=FILE

When cloning code repos from a manifest, generate a cgit-compatible
project list.

If C<FILE> does not start with C</>, C<./>, or C<../>, it is treated
as relative to the C<DESTINATION> directory.  If only C<--project-list=>
is specified where C<FILE> is an empty string (C<"">), then C<projects.list>
(C<$DESTINATION/projects.list>) is the implied value of C<FILE>.

=item --post-update-hook=COMMAND

Hooks to run after a repository is cloned or updated, C<COMMAND> will
have the bare git repository destination given as its first and only
argument.

For v2 inboxes, this operates on a per-epoch basis.

May be specified multiple times to run multiple commands in the
order specified on the command-line.

=item -p

=item --prune

Pass the C<--prune> and C<--prune-tags> flags to L<git-fetch(1)>
calls on incremental clones.

=item -k

=item --keep-going

Continue as much as possible after an error.

=item -n

=item --dry-run

Show what would be done, without making any changes.

=item -q

=item --quiet

Quiets down progress messages, also passed to L<git-fetch(1)>.

=item -v

=item --verbose

Increases verbosity, also passed to L<git-fetch(1)>.

=item --torsocks=auto|no|yes

=item --no-torsocks

Whether to wrap L<git(1)> and L<curl(1)> commands with L<torsocks(1)>.

Default: C<auto>

=back

=head1 CONTACT

Feedback welcome via plain-text mail to L<mailto:meta@public-inbox.org>

The mail archives are hosted at L<https://public-inbox.org/meta/> and
L<http://4uok3hntl7oi7b4uf4rtfwefqeexfzil2w6kgk2jn5z2f764irre7byd.onion/meta/>

=head1 COPYRIGHT

Copyright all contributors L<mailto:meta@public-inbox.org>

License: AGPL-3.0+ L<https://www.gnu.org/licenses/agpl-3.0.txt>

=head1 SEE ALSO

L<public-inbox-fetch(1)>, L<public-inbox-init(1)>, L<public-inbox-index(1)>
